<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detalle de Validación - ISS Viáticos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              apple: {
                bg: "#f5f5f7",
                card: "rgba(255, 255, 255, 0.72)",
                text: "#1d1d1f",
                secondary: "#86868b",
                blue: "#0071e3",
                border: "rgba(0, 0, 0, 0.1)",
              },
            },
          },
        },
      };
    </script>
    <style>
      body {
        background-color: #f5f5f7;
        color: #1d1d1f;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          sans-serif;
      }
      .glass {
        background: rgba(255, 255, 255, 0.72);
        backdrop-filter: saturate(180%) blur(20px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.1);
      }
      .apple-card {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
    </style>
  </head>
  <body class="antialiased">
    <!-- Nav -->
    <nav class="fixed top-0 w-full z-50 glass">
      <div
        class="max-w-6xl mx-auto px-6 h-11 flex items-center justify-between"
      >
        <div class="flex items-center gap-8">
          <a
            href="/"
            class="text-[12px] font-semibold tracking-tight opacity-90 hover:opacity-100 transition-opacity"
            >ISS Viáticos / Admin</a
          >
          <ul class="hidden md:flex gap-8 list-none">
            <li>
              <a
                href="/admin/validaciones"
                class="text-[12px] font-bold text-green-600"
                >Regresar a Validaciones</a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <main class="pt-24 pb-20 px-6">
      <div class="max-w-5xl mx-auto">
        <!-- Header Resumen -->
        <div
          class="bg-white rounded-[32px] p-10 shadow-sm border border-apple-border mb-10"
        >
          <div
            class="flex flex-col md:flex-row justify-between items-start md:items-center gap-6"
          >
            <div>
              <div class="flex items-center gap-3 mb-3">
                <span
                  class="px-3 py-1 bg-green-50 text-green-600 rounded-full text-[10px] font-bold uppercase tracking-wider"
                  >Esperando Validación</span
                >
                <span
                  class="text-[11px] text-apple-secondary font-medium uppercase tracking-widest"
                  th:text="${'ID: #' + sol.id}"
                  >ID: #001</span
                >
              </div>
              <h1
                class="text-4xl font-semibold tracking-tight text-apple-text mb-1"
                th:text="${sol.motivoViaje}"
              >
                Motivo del Viaje
              </h1>
              <p
                class="text-xl text-apple-secondary"
                th:text="${sol.empleado.nombres + ' ' + sol.empleado.apellidos}"
              >
                Colaborador
              </p>
            </div>

            <div
              class="grid grid-cols-1 md:grid-cols-3 gap-8 text-right bg-gray-50 p-6 rounded-[24px]"
            >
              <div>
                <p
                  class="text-[10px] text-apple-secondary uppercase font-bold mb-1"
                >
                  Presupuesto
                </p>
                <p
                  class="text-xl font-bold text-apple-text"
                  th:text="${'S/ ' + #numbers.formatDecimal(sol.montoTotal, 1, 2)}"
                >
                  S/ 0.00
                </p>
              </div>
              <div>
                <p
                  class="text-[10px] text-apple-secondary uppercase font-bold mb-1"
                >
                  Total Rendido
                </p>
                <p
                  class="text-xl font-bold text-apple-blue"
                  th:text="${'S/ ' + #numbers.formatDecimal(ren.totalGastadoBruto, 1, 2)}"
                >
                  S/ 0.00
                </p>
              </div>
              <div>
                <p
                  class="text-[10px] text-apple-secondary uppercase font-bold mb-1"
                >
                  Total Aceptado
                </p>
                <p
                  class="text-xl font-bold text-green-600"
                  th:text="${'S/ ' + #numbers.formatDecimal(ren.totalAceptado, 1, 2)}"
                >
                  S/ 0.00
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Listado de Comprobantes para Validar -->
        <div class="space-y-6">
          <h2 class="text-xl font-bold px-4 flex items-center gap-2">
            <i data-lucide="list-checks" class="w-6 h-6 text-green-600"></i>
            Comprobantes por Revisar
          </h2>

          <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Card de Comprobante -->
            <div
              th:each="det : ${ren.detalles}"
              class="bg-white rounded-[32px] border border-apple-border overflow-hidden shadow-sm hover:shadow-md transition-all"
            >
              <!-- Header del Card: Estado -->
              <div
                class="px-8 py-4 border-b border-gray-50 flex justify-between items-center bg-gray-50/50"
              >
                <span
                  class="text-[10px] font-bold uppercase tracking-widest text-apple-secondary"
                  th:text="${det.tipoGasto.nombre}"
                  >Tipo Gasto</span
                >

                <div class="flex items-center gap-2">
                  <span
                    th:if="${det.estadoValidacion.name() == 'PENDIENTE'}"
                    class="flex items-center gap-1.5 text-[9px] font-bold uppercase text-amber-500"
                  >
                    <span
                      class="w-1.5 h-1.5 bg-amber-500 rounded-full animate-pulse"
                    ></span>
                    Pendiente
                  </span>
                  <span
                    th:if="${det.estadoValidacion.name() == 'ACEPTADO'}"
                    class="flex items-center gap-1.5 text-[9px] font-bold uppercase text-green-500"
                  >
                    <i data-lucide="check-circle-2" class="w-3.5 h-3.5"></i>
                    Aceptado
                  </span>
                  <span
                    th:if="${det.estadoValidacion.name() == 'RECHAZADO'}"
                    class="flex items-center gap-1.5 text-[9px] font-bold uppercase text-red-500"
                  >
                    <i data-lucide="x-circle" class="w-3.5 h-3.5"></i> Rechazado
                  </span>
                </div>
              </div>

              <div class="p-8">
                <div class="flex justify-between items-start mb-6">
                  <div>
                    <h3
                      class="text-lg font-bold text-apple-text leading-tight mb-1"
                      th:text="${det.razonSocialProveedor}"
                    >
                      Nombre de la Empresa
                    </h3>
                    <p
                      class="text-[10px] text-apple-secondary uppercase font-medium tracking-wider"
                      th:text="${'RUC: ' + det.rucProveedor}"
                    >
                      RUC: 12345678901
                    </p>
                  </div>
                  <div class="text-right">
                    <p
                      class="text-2xl font-bold text-apple-text"
                      th:text="${'S/ ' + #numbers.formatDecimal(det.montoTotal, 1, 2)}"
                    >
                      S/ 0.00
                    </p>
                    <p
                      class="text-[10px] text-apple-secondary uppercase font-bold"
                      th:text="${det.serieNumeroComprobante}"
                    >
                      SERIE - N°
                    </p>
                  </div>
                </div>

                <div
                  class="flex items-center gap-2 mb-8 text-xs text-apple-secondary"
                >
                  <i data-lucide="calendar" class="w-3.5 h-3.5"></i>
                  <span th:text="${'Emitido el ' + det.fechaEmision}"
                    >01/01/2024</span
                  >
                </div>

                <!-- Acciones de Validación -->
                <div
                  th:if="${det.estadoValidacion.name() == 'PENDIENTE'}"
                  class="grid grid-cols-2 gap-4"
                >
                  <form
                    th:action="@{/admin/validaciones/comprobante/validar}"
                    method="post"
                  >
                    <input
                      type="hidden"
                      name="detalleId"
                      th:value="${det.id}"
                    />
                    <input
                      type="hidden"
                      name="solicitudId"
                      th:value="${sol.id}"
                    />
                    <input type="hidden" name="estado" value="ACEPTADO" />
                    <button
                      type="submit"
                      class="w-full py-3 bg-green-50 text-green-600 font-bold rounded-2xl hover:bg-green-100 transition-all flex items-center justify-center gap-2"
                    >
                      <i data-lucide="check" class="w-4 h-4"></i>
                      Aceptar
                    </button>
                  </form>
                  <button
                    onclick="this.closest('.p-8').querySelector('.form-rechazo').classList.toggle('hidden')"
                    class="w-full py-3 bg-red-50 text-red-500 font-bold rounded-2xl hover:bg-red-100 transition-all flex items-center justify-center gap-2"
                  >
                    <i data-lucide="x" class="w-4 h-4"></i>
                    Rechazar
                  </button>
                </div>

                <!-- Formulario Oculto de Rechazo -->
                <div
                  class="form-rechazo hidden mt-4 pt-4 border-t border-gray-100"
                >
                  <form
                    th:action="@{/admin/validaciones/comprobante/validar}"
                    method="post"
                    class="space-y-3"
                  >
                    <input
                      type="hidden"
                      name="detalleId"
                      th:value="${det.id}"
                    />
                    <input
                      type="hidden"
                      name="solicitudId"
                      th:value="${sol.id}"
                    />
                    <input type="hidden" name="estado" value="RECHAZADO" />
                    <label
                      class="text-[10px] font-bold text-red-500 uppercase px-1"
                      >Motivo del rechazo</label
                    >
                    <textarea
                      name="motivo"
                      required
                      placeholder="Ej: Comprobante ilegible o no corresponde al viaje."
                      class="w-full p-4 bg-red-50/50 border-none rounded-2xl text-xs focus:ring-1 focus:ring-red-400 outline-none h-20"
                    ></textarea>
                    <button
                      type="submit"
                      class="w-full py-3 bg-red-500 text-white font-bold rounded-2xl hover:bg-red-600 transition-all"
                    >
                      Confirmar Rechazo
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>

          <!-- Botón Finalizar Revisión -->
          <div
            class="bg-black text-white p-10 rounded-[32px] mt-12 flex flex-col md:flex-row justify-between items-center gap-6 shadow-xl"
          >
            <div class="flex items-center gap-4">
              <div
                class="w-14 h-14 bg-white/10 rounded-2xl flex items-center justify-center"
              >
                <i data-lucide="flag" class="w-7 h-7 text-green-400"></i>
              </div>
              <div>
                <h4 class="text-xl font-bold">Resumen de Revisión</h4>
                <p class="text-gray-400 text-sm">
                  Asegúrate de haber validado todos los comprobantes antes de
                  finalizar.
                </p>
              </div>
            </div>
            <form th:action="@{/admin/validaciones/finalizar}" method="post">
              <input type="hidden" name="solicitudId" th:value="${sol.id}" />
              <button
                type="submit"
                class="px-10 py-5 bg-green-500 text-white font-bold rounded-2xl hover:bg-green-600 transition-all shadow-lg flex items-center gap-2"
              >
                Finalizar y Liquidar
                <i data-lucide="award" class="w-5 h-5"></i>
              </button>
            </form>
          </div>
        </div>
      </div>
    </main>

    <script>
      lucide.createIcons();
    </script>
  </body>
</html>
