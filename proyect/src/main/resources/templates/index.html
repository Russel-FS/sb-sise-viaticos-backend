<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - ISS Viáticos</title>

    <!-- External Resources -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Theme Handling -->
    <script>
      (function () {
        const savedTheme = localStorage.getItem("theme");
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;
        if (savedTheme === "dark" || (!savedTheme && prefersDark)) {
          document.documentElement.classList.add("dark");
        }
      })();
    </script>
    <th:block th:replace="~{fragments/theme :: themeStyles}"></th:block>

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              serif: ['"Instrument Serif"', "serif"],
              sans: [
                "Inter",
                "-apple-system",
                "BlinkMacSystemFont",
                "sans-serif",
              ],
            },
            colors: {
              canvas: {
                light: "#F9F8F6", // Hims-like warm cream
                dark: "#0F1115", // Deep charcoal
              },
              card: {
                light: "#FFFFFF",
                dark: "#1C1E22",
              },
              accent: {
                sage: "#E3ECD2",
                forest: "#2D3B2D",
                clay: "#D4A373",
                sand: "#EFEBE0",
              },
              status: {
                pending: "#E3B505",
                approved: "#2D3B2D", // Forest green for approved
                liquidated: "#6B7280",
              },
            },
            borderRadius: {
              "4xl": "2rem",
              "5xl": "2.5rem",
            },
            boxShadow: {
              premium: "0 20px 40px -12px rgba(0, 0, 0, 0.05)",
              glow: "0 0 20px rgba(0,0,0,0.05)",
            },
          },
        },
      };
    </script>

    <style>
      body {
        background-color: #f9f8f6;
        color: #1a1a1a;
        font-family: "Inter", sans-serif;
        -webkit-font-smoothing: antialiased;
        overflow-x: hidden;
      }
      .dark body {
        background-color: #0f1115;
        color: #f1f1f1;
      }

      h1,
      h2,
      h3,
      .serif-font {
        font-family: "Instrument Serif", serif;
      }

      /* Premium Glass Nav */
      .nav-island {
        background: rgba(255, 255, 255, 0.6);
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border: 1px solid rgba(255, 255, 255, 0.5);
        box-shadow: 0 4px 30px rgba(0, 0, 0, 0.03);
      }
      .dark .nav-island {
        background: rgba(28, 30, 34, 0.6);
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      /* Bento Grid Cards */
      .bento-card {
        background: white;
        border-radius: 2rem;
        border: 1px solid rgba(0, 0, 0, 0.02);
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02),
          0 2px 4px -1px rgba(0, 0, 0, 0.02);
        transition: transform 0.4s cubic-bezier(0.16, 1, 0.3, 1),
          box-shadow 0.4s ease;
      }
      .dark .bento-card {
        background: #1c1e22;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }
      .bento-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 20px 40px -12px rgba(0, 0, 0, 0.06);
      }

      /* animaciones */
      @keyframes fade-in-up {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-enter {
        animation: fade-in-up 0.8s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        opacity: 0;
      }
      .delay-100 {
        animation-delay: 100ms;
      }
      .delay-200 {
        animation-delay: 200ms;
      }
      .delay-300 {
        animation-delay: 300ms;
      }

      /* escrollabar */
      ::-webkit-scrollbar {
        width: 6px;
        height: 6px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: #e5e5e5;
        border-radius: 10px;
      }
      .dark ::-webkit-scrollbar-thumb {
        background: #333;
      }
    </style>
  </head>
  <body
    class="min-h-screen pb-20 selection:bg-accent-sage selection:text-accent-forest"
  >
    <div class="fixed top-6 left-0 right-0 z-50 flex justify-center px-4">
      <nav
        class="nav-island rounded-full px-6 py-3 flex items-center gap-8 animate-enter"
      >
        <a
          href="/"
          class="serif-font text-xl font-medium tracking-tight hover:opacity-70 transition-opacity"
        >
          ISS V
        </a>

        <div
          class="hidden md:flex items-center gap-1 bg-gray-100/50 dark:bg-white/5 rounded-full p-1"
        >
          <a
            href="/solicitudes"
            class="px-4 py-1.5 rounded-full text-xs font-medium hover:bg-white dark:hover:bg-white/10 hover:shadow-sm transition-all text-gray-700 dark:text-gray-300"
            >Solicitudes</a
          >

          <th:block th:if="${isAdmin}">
            <a
              href="/admin/aprobaciones"
              class="px-4 py-1.5 rounded-full text-xs font-medium hover:bg-white dark:hover:bg-white/10 hover:shadow-sm transition-all text-gray-700 dark:text-gray-300"
              >Aprobar</a
            >
            <a
              href="/admin/validaciones"
              class="px-4 py-1.5 rounded-full text-xs font-medium hover:bg-white dark:hover:bg-white/10 hover:shadow-sm transition-all text-gray-700 dark:text-gray-300"
              >Validar</a
            >
            <a
              href="/admin/empleados"
              class="px-4 py-1.5 rounded-full text-xs font-medium hover:bg-white dark:hover:bg-white/10 hover:shadow-sm transition-all text-gray-700 dark:text-gray-300"
              >Empleados</a
            >
            <a
              href="/admin/tarifarios"
              class="px-4 py-1.5 rounded-full text-xs font-medium hover:bg-white dark:hover:bg-white/10 hover:shadow-sm transition-all text-gray-700 dark:text-gray-300"
              >Config</a
            >
          </th:block>
        </div>

        <div class="flex items-center gap-4">
          <div
            class="flex items-center gap-3 pl-4 border-l border-gray-200 dark:border-white/10"
          >
            <button
              onclick="toggleTheme()"
              class="w-8 h-8 rounded-full flex items-center justify-center hover:bg-gray-100 dark:hover:bg-white/10 transition-colors"
            >
              <i
                data-lucide="sun"
                class="w-3 h-3 text-gray-500 hidden dark:block"
              ></i>
              <i
                data-lucide="moon"
                class="w-3 h-3 text-gray-500 block dark:hidden"
              ></i>
            </button>
            <form th:action="@{/logout}" method="post">
              <button
                type="submit"
                class="w-8 h-8 rounded-full bg-gray-900 text-white dark:bg-white dark:text-black flex items-center justify-center hover:scale-105 transition-transform"
                title="Salir"
              >
                <i data-lucide="log-out" class="w-3 h-3"></i>
              </button>
            </form>
          </div>
        </div>
      </nav>
    </div>

    <main class="max-w-[1400px] mx-auto px-6 pt-32">
      <!-- bienvenido hero -->
      <header class="mb-16 max-w-4xl animate-enter delay-100">
        <div
          class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-accent-sage/30 text-accent-forest dark:bg-green-900/30 dark:text-green-200 text-xs font-semibold uppercase tracking-wider mb-6"
        >
          <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
          Sistema Operativo
        </div>
        <h1
          class="text-6xl md:text-7xl mb-6 leading-[0.9] text-gray-900 dark:text-gray-100 italic"
        >
          <span class="serif-font not-italic">Bienvenido,</span><br />
          <span
            class="text-gray-400 dark:text-gray-500 text-5xl md:text-6xl"
            th:text="${currentUser != null ? currentUser.nombreCompleto.split(' ')[0] : 'Usuario'}"
            >Usuario</span
          >
        </h1>
        <p class="text-lg text-gray-500 dark:text-gray-400 max-w-xl font-light">
          Gestión inteligente de viáticos y desplazamientos. Todo lo que
          necesitas para tu próximo viaje, organizado en un solo lugar.
        </p>
      </header>

      <!-- grid bento -->
      <div class="grid grid-cols-1 md:grid-cols-12 gap-6 mb-20">
        <!-- Big Card: solicitud nueva -->
        <div
          class="col-span-1 md:col-span-8 lg:col-span-7 row-span-2 bento-card p-10 relative overflow-hidden group animate-enter delay-200"
        >
          <div
            class="absolute top-0 right-0 w-64 h-64 bg-accent-sage/20 rounded-full blur-3xl -mr-16 -mt-16 transition-all group-hover:bg-accent-sage/30"
          ></div>

          <div class="relative z-10 h-full flex flex-col justify-between">
            <div>
              <h3 class="text-3xl font-medium mb-2 dark:text-white">
                Nueva Solicitud
              </h3>
              <p class="text-gray-500 dark:text-gray-400 mb-8 max-w-sm">
                Inicia un nuevo trámite de comisión. Calcularemos los viáticos
                automáticamente según el destino.
              </p>
            </div>

            <div class="flex items-center gap-4">
              <a
                href="/solicitudes/nueva"
                class="inline-flex items-center gap-3 bg-gray-900 dark:bg-white text-white dark:text-black px-8 py-4 rounded-full font-medium hover:scale-105 active:scale-95 transition-all shadow-xl shadow-gray-200 dark:shadow-none"
              >
                <span class="serif-font italic text-lg pr-1">Iniciar</span>
                <i data-lucide="arrow-right" class="w-4 h-4"></i>
              </a>
            </div>
          </div>

          <!-- icono avion -->
          <i
            data-lucide="plane"
            class="absolute bottom-[-20px] right-[-20px] w-64 h-64 text-gray-50 dark:text-white/5 rotate-[-15deg] group-hover:rotate-0 transition-transform duration-700"
          ></i>
        </div>

        <!-- Stat Card 1: Pendientes -->
        <div
          class="col-span-1 md:col-span-4 lg:col-span-5 bento-card p-8 flex items-center justify-between animate-enter delay-200 bg-[#FFFBEB] dark:bg-yellow-900/10 border-none"
        >
          <div>
            <p
              class="text-xs font-bold uppercase tracking-widest text-yellow-600/70 mb-1"
            >
              En Proceso
            </p>
            <div
              class="font-serif text-5xl text-yellow-600 dark:text-yellow-400"
              th:text="${totalPendientes}"
            >
              0
            </div>
          </div>
          <div
            class="w-12 h-12 rounded-full bg-yellow-600/10 flex items-center justify-center text-yellow-600"
          >
            <i data-lucide="hourglass" class="w-6 h-6"></i>
          </div>
        </div>

        <!-- Stat Card 2: Aprobadas -->
        <div
          class="col-span-1 md:col-span-4 lg:col-span-5 bento-card p-8 flex items-center justify-between animate-enter delay-300 bg-[#F0FDF4] dark:bg-green-900/10 border-none"
        >
          <div>
            <p
              class="text-xs font-bold uppercase tracking-widest text-green-600/70 mb-1"
            >
              Aprobadas
            </p>
            <div
              class="font-serif text-5xl text-green-700 dark:text-green-400"
              th:text="${totalAprobados}"
            >
              0
            </div>
          </div>
          <div
            class="w-12 h-12 rounded-full bg-green-600/10 flex items-center justify-center text-green-600"
          >
            <i data-lucide="check-circle" class="w-6 h-6"></i>
          </div>
        </div>

        <!--  Chart Area -->
        <div
          class="col-span-1 md:col-span-4 lg:col-span-4 row-span-2 bento-card p-6 flex flex-col animate-enter delay-300"
        >
          <div class="flex items-center justify-between mb-6">
            <h3 class="text-lg font-serif dark:text-white">Estado Global</h3>
            <i data-lucide="pie-chart" class="w-4 h-4 text-gray-400"></i>
          </div>

          <div class="relative flex-1 flex items-center justify-center px-4">
            <canvas id="statusChart"></canvas>
            <!-- texto centro -->
            <div
              class="absolute inset-0 flex items-center justify-center pointer-events-none"
            >
              <div class="text-center mt-2">
                <span
                  class="block text-xs text-gray-400 font-medium tracking-wide"
                  >TOTAL</span
                >
                <span
                  class="serif-font text-2xl text-gray-900 dark:text-white"
                  th:text="${totalPendientes + totalAprobados + totalLiquidados}"
                  >0</span
                >
              </div>
            </div>
          </div>
          <div
            class="mt-6 flex justify-center gap-4 text-[10px] uppercase font-bold tracking-widest text-gray-400"
          >
            <div class="flex items-center gap-1">
              <span class="w-2 h-2 rounded-full bg-yellow-400"></span>Pend
            </div>
            <div class="flex items-center gap-1">
              <span class="w-2 h-2 rounded-full bg-green-500"></span>Apr
            </div>
            <div class="flex items-center gap-1">
              <span class="w-2 h-2 rounded-full bg-blue-500"></span>Liq
            </div>
          </div>
        </div>

        <!-- lista de actividad reciente  -->
        <div
          class="col-span-1 md:col-span-8 lg:col-span-8 animate-enter delay-300"
        >
          <div class="bento-card p-8 min-h-[400px]">
            <div class="flex items-center justify-between mb-8">
              <div>
                <h3 class="text-2xl font-serif text-gray-900 dark:text-white">
                  Recientes
                </h3>
                <p class="text-sm text-gray-500">
                  Tus últimos movimientos y solicitudes.
                </p>
              </div>
              <a
                href="/solicitudes"
                class="w-10 h-10 rounded-full border border-gray-100 dark:border-white/10 flex items-center justify-center hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"
              >
                <i
                  data-lucide="arrow-up-right"
                  class="w-4 h-4 text-gray-600 dark:text-gray-300"
                ></i>
              </a>
            </div>

            <div class="space-y-3">
              <!-- Empty State -->
              <div
                th:if="${#lists.isEmpty(solicitudes)}"
                class="flex flex-col items-center justify-center py-12 text-center"
              >
                <div
                  class="w-16 h-16 bg-gray-50 dark:bg-white/5 rounded-full flex items-center justify-center mb-4"
                >
                  <i data-lucide="wind" class="w-6 h-6 text-gray-400"></i>
                </div>
                <p class="text-gray-500 text-sm">Todo tranquilo por aquí.</p>
              </div>

              <!-- lista de solicitudes -->
              <div
                th:each="sol : ${solicitudes}"
                class="group flex items-center justify-between p-4 rounded-2xl hover:bg-gray-50 dark:hover:bg-white/5 border border-transparent hover:border-gray-100 dark:hover:border-white/5 transition-all cursor-pointer"
                th:data-id="${sol.id}"
                onclick="window.location.href='/solicitudes/' + this.dataset.id"
              >
                <div class="flex items-center gap-5">
                  <div
                    class="w-12 h-12 rounded-xl flex items-center justify-center shadow-sm"
                    th:classappend="${sol.estado.name() == 'PENDIENTE' ? 'bg-[#FFF9E6] text-[#FFB020]' : 
                                            (sol.estado.name() == 'APROBADO' ? 'bg-[#E6F4EA] text-[#1E8E3E]' : 
                                            (sol.estado.name() == 'LIQUIDADO' ? 'bg-[#E8F0FE] text-[#1967D2]' : 'bg-gray-100 text-gray-500'))}"
                  >
                    <i
                      th:if="${sol.estado.name() == 'PENDIENTE'}"
                      data-lucide="clock"
                      class="w-5 h-5"
                    ></i>
                    <i
                      th:if="${sol.estado.name() == 'APROBADO'}"
                      data-lucide="check"
                      class="w-5 h-5"
                    ></i>
                    <i
                      th:if="${sol.estado.name() == 'LIQUIDADO'}"
                      data-lucide="check-circle-2"
                      class="w-5 h-5"
                    ></i>
                    <i
                      th:if="${sol.estado.name() == 'RECHAZADO'}"
                      data-lucide="x"
                      class="w-5 h-5"
                    ></i>
                  </div>

                  <div>
                    <h4
                      class="font-medium text-gray-900 dark:text-white"
                      th:text="${sol.motivoViaje}"
                    >
                      Viaje a Lima
                    </h4>
                    <div class="flex items-center gap-2 mt-0.5">
                      <i
                        data-lucide="calendar"
                        class="w-3 h-3 text-gray-400"
                      ></i>
                      <span
                        class="text-xs text-gray-500 font-medium"
                        th:text="${sol.fechaInicio}"
                        >01/01/2024</span
                      >
                    </div>
                  </div>
                </div>

                <div class="text-right">
                  <span
                    class="block text-sm font-bold text-gray-900 dark:text-white"
                    th:text="${'S/ ' + #numbers.formatDecimal(sol.montoTotal, 1, 0)}"
                    >S/ 0</span
                  >
                  <span
                    class="text-[10px] font-bold uppercase tracking-widest px-2 py-0.5 rounded-full inline-block mt-1"
                    th:classappend="${sol.estado.name() == 'PENDIENTE' ? 'bg-yellow-100 text-yellow-700' : 
                                            (sol.estado.name() == 'APROBADO' ? 'bg-green-100 text-green-700' : 'bg-gray-100 text-gray-600')}"
                    th:text="${sol.estado}"
                  >
                    ESTADO
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Widgets -->
        <div
          class="col-span-1 md:col-span-12 lg:col-span-12 mt-4 animate-enter delay-300"
        >
          <h3 class="text-xl font-serif mb-6 px-2 dark:text-white">
            Descubrir
          </h3>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Feature 1 -->
            <a
              href="/politicas"
              class="bento-card p-6 flex items-start gap-4 group hover:bg-[#F4F2ED] dark:hover:bg-white/5"
            >
              <div
                class="w-10 h-10 rounded-full bg-orange-100 text-orange-600 flex items-center justify-center shrink-0"
              >
                <i data-lucide="book-open" class="w-5 h-5"></i>
              </div>
              <div>
                <h4
                  class="font-bold text-gray-900 dark:text-white group-hover:underline decoration-orange-300/50 underline-offset-4"
                >
                  Políticas de Viáticos 2024
                </h4>
                <p class="text-xs text-gray-500 mt-2 leading-relaxed">
                  Conoce los nuevos límites y categorías de rendición aceptados
                  esta temporada.
                </p>
              </div>
            </a>

            <!-- Feature 2 -->
            <div
              class="bento-card p-6 flex items-start gap-4 relative overflow-hidden"
            >
              <div
                class="w-10 h-10 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center shrink-0 z-10"
              >
                <i data-lucide="map" class="w-5 h-5"></i>
              </div>
              <div class="z-10">
                <h4 class="font-bold text-gray-900 dark:text-white">
                  Mapa de Cobertura
                </h4>
                <p class="text-xs text-gray-500 mt-2 leading-relaxed">
                  Visualiza las zonas autorizadas para comisiones sin aprobación
                  especial.
                </p>
              </div>
              <svg
                class="absolute right-[-20px] bottom-[-20px] opacity-10 w-32 h-32"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1"
              >
                <path d="M3 7l6-3 6 3 6-3v13l-6 3-6-3-6 3V7z"></path>
              </svg>
            </div>

            <!-- Feature 3 -->
            <div
              class="bento-card p-6 flex items-start gap-4 cursor-help"
              title="Próximamente"
            >
              <div
                class="w-10 h-10 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center shrink-0"
              >
                <i data-lucide="sparkles" class="w-5 h-5"></i>
              </div>
              <div>
                <h4 class="font-bold text-gray-900 dark:text-white">
                  Asistente Virtual
                </h4>
                <p class="text-xs text-gray-500 mt-2 leading-relaxed">
                  ¿Dudas con tu rendición? Nuestro asistente AI estará
                  disponible pronto.
                </p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="py-12 text-center animate-enter delay-300">
      <div
        class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white dark:bg-white/5 border border-gray-100 dark:border-white/10 shadow-sm"
      >
        <div class="w-2 h-2 rounded-full bg-green-500"></div>
        <span
          class="text-[10px] font-bold uppercase tracking-widest text-gray-400"
          >Sistema Conectado</span
        >
      </div>
      <p class="mt-6 text-xs text-gray-400 font-medium">
        © 2024 ISS Viáticos. Designed for Excellence.
      </p>
    </footer>

    <!-- Scripts -->
    <script th:inline="javascript">
      lucide.createIcons();

      document.addEventListener("DOMContentLoaded", function () {
        const ctx = document.getElementById("statusChart").getContext("2d");
        const labels = /*[[${chartLabels}]]*/ [];
        const data = /*[[${chartData}]]*/ [];

        new Chart(ctx, {
          type: "doughnut",
          data: {
            labels: labels,
            datasets: [
              {
                data: data,
                backgroundColor: ["#E3B505", "#2D3B2D", "#6B7280", "#E11D48"],
                borderWidth: 0,
                hoverOffset: 4,
                borderRadius: 20,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            cutout: "85%",
            plugins: {
              legend: { display: false },
              tooltip: {
                backgroundColor: "rgba(0,0,0,0.8)",
                padding: 12,
                cornerRadius: 8,
                titleFont: { family: "Inter", size: 10 },
                bodyFont: { family: "Inter", size: 14, weight: "bold" },
              },
            },
          },
        });
      });
    </script>

    <th:block th:replace="~{fragments/theme :: themeScript}"></th:block>
  </body>
</html>
