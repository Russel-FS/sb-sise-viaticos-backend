<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mis Solicitudes - ISS Viáticos</title>

    <!-- recursos externos -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- manejo de temas -->
    <script>
      (function () {
        const savedTheme = localStorage.getItem("theme");
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;
        if (savedTheme === "dark" || (!savedTheme && prefersDark)) {
          document.documentElement.classList.add("dark");
        }
      })();
    </script>
    <th:block th:replace="~{fragments/theme :: themeStyles}"></th:block>

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            colors: {
              aura: {
                blue: "#0071e3",
                surface: "rgba(255, 255, 255, 0.8)",
                bg: "#f5f5f7",
                text: "#1d1d1f",
                gray: "#86868b",
                border: "rgba(0, 0, 0, 0.05)",
              },
              dark: {
                bg: "#000000",
                surface: "rgba(28, 28, 30, 0.8)",
                border: "rgba(255, 255, 255, 0.1)",
              },
            },
            borderRadius: {
              aura: "28px",
            },
          },
        },
      };
    </script>

    <style>
      body {
        background-color: #f5f5f7;
        color: #1d1d1f;
        font-family: "Inter", sans-serif;
        -webkit-font-smoothing: antialiased;
      }
      .dark body {
        background-color: #000000;
        color: #f5f5f7;
      }

      /* Aura Cards */
      .aura-card {
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(20px);
        -webkit-backdrop-filter: blur(20px);
        border-radius: 28px;
        border: 1px solid rgba(0, 0, 0, 0.05);
        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1),
          box-shadow 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        backface-visibility: hidden;
        transform: translateZ(0);
      }
      .dark .aura-card {
        background: rgba(28, 28, 30, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }
      .aura-card:hover {
        transform: translateY(-2px) translateZ(0);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.04);
      }

      /* animaciones */
      @keyframes fade-in {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-fade {
        animation: fade-in 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
        opacity: 0;
      }

      /* custom scroll */
      ::-webkit-scrollbar {
        width: 8px;
      }
      ::-webkit-scrollbar-track {
        background: transparent;
      }
      ::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        border: 2px solid transparent;
        background-clip: content-box;
      }
      .dark ::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
      }
    </style>
    <th:block th:replace="~{fragments/nav :: styles}"></th:block>
  </head>
  <body class="min-h-screen pb-20">
    <!-- nav -->
    <th:block
      th:replace="~{fragments/nav :: navbar(activeTab='solicitudes')}"
    ></th:block>

    <main class="max-w-7xl mx-auto px-6 pt-24 md:pt-32">
      <!-- Header -->
      <div
        class="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-12 animate-fade"
      >
        <div>
          <p class="text-[17px] font-semibold text-aura-blue mb-2">
            Mi Actividad
          </p>
          <h1
            class="text-[40px] md:text-[48px] font-bold tracking-tight leading-tight"
          >
            Mis Solicitudes
          </h1>
          <p class="text-[19px] md:text-[21px] text-aura-gray mt-2 max-w-2xl">
            Historial completo de tus comisiones y rendiciones.
          </p>
        </div>
        <a
          href="/solicitudes/nueva"
          class="inline-flex items-center gap-2 bg-aura-blue text-white px-8 py-4 rounded-[18px] font-semibold text-[17px] hover:bg-blue-600 transition-colors shadow-lg shadow-blue-500/20"
        >
          <i data-lucide="plus" class="w-5 h-5"></i>
          Nueva Solicitud
        </a>
      </div>

      <!-- Grid de Solicitudes (Estilo Apple Cards) -->
      <div class="space-y-6">
        <!-- estado vacio -->
        <div
          th:if="${#lists.isEmpty(solicitudes)}"
          class="aura-card p-20 flex flex-col items-center justify-center text-center animate-fade"
        >
          <div
            class="w-20 h-20 bg-aura-blue/5 rounded-full flex items-center justify-center mb-6"
          >
            <i data-lucide="inbox" class="w-10 h-10 text-aura-gray"></i>
          </div>
          <h3 class="text-[24px] font-bold mb-2">Sin solicitudes activas</h3>
          <p class="text-aura-gray text-[17px] max-w-xs">
            Comienza creando tu primera comisión de servicio ahora mismo.
          </p>
        </div>

        <!-- Lista de solicitudes -->
        <div
          th:each="sol, iter : ${solicitudes}"
          class="aura-card p-6 md:p-8 animate-fade"
          th:style="'animation-delay: ' + (${iter.index} * 0.05 + 0.1) + 's'"
        >
          <div
            class="flex flex-col md:flex-row items-start md:items-center justify-between gap-6"
          >
            <div class="flex items-center gap-6">
              <!-- Icono de estado dinámico -->
              <div
                class="w-14 h-14 rounded-[20px] flex items-center justify-center shrink-0 shadow-sm"
                th:classappend="${sol.estado.name() == 'PENDIENTE' ? 'bg-orange-500/10 text-orange-500' : 
                                  (sol.estado.name() == 'APROBADO' ? 'bg-green-500/10 text-green-500' : 
                                  (sol.estado.name() == 'LIQUIDADO' ? 'bg-blue-500/10 text-blue-500' : 'bg-aura-gray/10 text-aura-gray'))}"
              >
                <i
                  th:if="${sol.estado.name() == 'PENDIENTE'}"
                  data-lucide="clock"
                  class="w-7 h-7"
                ></i>
                <i
                  th:if="${sol.estado.name() == 'BORRADOR'}"
                  data-lucide="edit-3"
                  class="w-7 h-7"
                ></i>
                <i
                  th:if="${sol.estado.name() == 'APROBADO'}"
                  data-lucide="check-circle-2"
                  class="w-7 h-7"
                ></i>
                <i
                  th:if="${sol.estado.name() == 'LIQUIDADO'}"
                  data-lucide="shield-check"
                  class="w-7 h-7"
                ></i>
                <i
                  th:if="${sol.estado.name() == 'RECHAZADO' || sol.estado.name() == 'CANCELADO'}"
                  data-lucide="alert-circle"
                  class="w-7 h-7"
                ></i>
                <i
                  th:if="${sol.estado.name() == 'RENDIDO'}"
                  data-lucide="file-check-2"
                  class="w-7 h-7"
                ></i>
                <i
                  th:if="${sol.estado.name() == 'OBSERVADO'}"
                  data-lucide="alert-triangle"
                  class="w-7 h-7"
                ></i>
              </div>

              <div>
                <div class="flex items-center gap-3 mb-1">
                  <h3
                    class="text-[21px] font-bold"
                    th:text="${sol.motivoViaje}"
                  >
                    Viaje a Lima
                  </h3>
                  <span
                    class="text-[11px] font-bold uppercase tracking-wider px-2 py-0.5 rounded-full inline-block"
                    th:classappend="${sol.estado.name() == 'PENDIENTE' ? 'bg-orange-500/10 text-orange-500' : 
                                    (sol.estado.name() == 'APROBADO' ? 'bg-green-500/10 text-green-500' : 
                                    (sol.estado.name() == 'LIQUIDADO' ? 'bg-black text-white dark:bg-white dark:text-black' : 'bg-aura-gray/10 text-aura-gray'))}"
                    th:text="${sol.estado}"
                  >
                    PENDIENTE
                  </span>
                </div>
                <div
                  class="flex flex-wrap items-center gap-x-4 gap-y-1 text-aura-gray text-[15px] font-medium"
                >
                  <span class="flex items-center gap-1.5">
                    <i
                      data-lucide="map-pin"
                      class="w-4 h-4 text-aura-blue/60"
                    ></i>
                    <span
                      th:text="${!sol.itinerarios.isEmpty() ? sol.itinerarios[0].zonaDestino.nombre : 'Sin destino'}"
                      >Destino</span
                    >
                  </span>
                  <span class="flex items-center gap-1.5">
                    <i data-lucide="calendar" class="w-4 h-4"></i>
                    <span
                      th:text="${sol.fechaInicio + ' — ' + (sol.fechaFin ?: '...') }"
                      >01/01/2024</span
                    >
                  </span>
                  <span
                    class="font-mono text-[13px] opacity-60"
                    th:text="${'#' + sol.id}"
                    >#001</span
                  >
                </div>
              </div>
            </div>

            <div
              class="flex items-center gap-8 w-full md:w-auto justify-between md:justify-end border-t md:border-t-0 border-aura-border pt-4 md:pt-0"
            >
              <div class="text-right">
                <p
                  class="text-[13px] font-bold text-aura-gray uppercase tracking-widest mb-1"
                >
                  Total
                </p>
                <p
                  class="text-[24px] font-bold"
                  th:text="${'S/ ' + #numbers.formatDecimal(sol.montoTotal, 1, 2)}"
                >
                  S/ 0.00
                </p>
              </div>

              <div class="flex items-center gap-3">
                <!-- Action: Rendir -->
                <a
                  th:if="${sol.estado.name() == 'APROBADO' || sol.estado.name() == 'OBSERVADO'}"
                  th:href="@{'/rendiciones/solicitud/' + ${sol.id}}"
                  class="h-12 px-6 bg-aura-text text-aura-bg dark:bg-white dark:text-black text-[14px] font-bold rounded-[14px] hover:opacity-90 transition-all flex items-center justify-center"
                >
                  Rendir
                </a>

                <!-- Action: Enviar (Borrador) -->
                <form
                  th:if="${sol.estado.name() == 'BORRADOR'}"
                  th:action="@{'/solicitudes/enviar/' + ${sol.id}}"
                  method="post"
                >
                  <button
                    type="submit"
                    class="h-12 px-6 bg-aura-blue text-white text-[14px] font-bold rounded-[14px] hover:bg-blue-600 transition-all flex items-center justify-center gap-2"
                  >
                    Enviar <i data-lucide="send" class="w-4 h-4"></i>
                  </button>
                </form>

                <!-- Detalle link -->
                <a
                  th:href="@{'/solicitudes/' + ${sol.id}}"
                  class="w-12 h-12 rounded-[14px] border border-aura-border flex items-center justify-center hover:bg-aura-gray/5 transition-colors group"
                >
                  <i
                    data-lucide="chevron-right"
                    class="w-6 h-6 text-aura-gray group-hover:text-aura-text transition-colors"
                  ></i>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <script th:inline="javascript">
      lucide.createIcons();
    </script>
    <th:block th:replace="~{fragments/theme :: themeScript}"></th:block>
  </body>
</html>
