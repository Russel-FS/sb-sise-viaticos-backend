<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mis Solicitudes - ISS Viáticos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: [
                "-apple-system",
                "BlinkMacSystemFont",
                '"Segoe UI"',
                "Roboto",
                "Helvetica",
                "Arial",
                "sans-serif",
              ],
            },
            colors: {
              apple: {
                bg: "#f5f5f7",
                card: "#ffffff",
                text: "#1d1d1f",
                secondary: "#86868b",
                blue: "#0071e3",
                link: "#06c",
                border: "#d2d2d7",
              },
            },
          },
        },
      };
    </script>
    <style>
      body {
        background-color: #f5f5f7;
        color: #1d1d1f;
      }
      .glass {
        background: rgba(255, 255, 255, 0.72);
        backdrop-filter: saturate(180%) blur(20px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      }
      .card-pro {
        background: #ffffff;
        border-radius: 24px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.02),
          0 2px 4px -1px rgba(0, 0, 0, 0.02);
        border: 1px solid rgba(0, 0, 0, 0.05);
      }
      .btn-primary {
        @apply px-6 py-3 bg-black text-white text-sm font-semibold rounded-full hover:bg-gray-800 transition-all shadow-lg shadow-black/10 active:scale-95 flex items-center gap-2;
      }
    </style>
  </head>
  <body class="antialiased selection:bg-apple-blue selection:text-white">
    <!-- Nav -->
    <nav class="fixed top-0 w-full z-50 glass">
      <div
        class="max-w-6xl mx-auto px-6 h-12 flex items-center justify-between"
      >
        <div class="flex items-center gap-8">
          <a
            href="/"
            class="text-[13px] font-medium tracking-tight text-gray-900/80 hover:text-black transition-colors"
          >
            ISS Viáticos
          </a>
          <ul class="hidden md:flex gap-6 list-none">
            <li>
              <a
                href="/solicitudes"
                class="text-[12px] font-bold text-apple-blue"
                >Solicitudes</a
              >
            </li>
            <li th:if="${isAdmin}">
              <a
                href="/admin/aprobaciones"
                class="text-[12px] font-medium text-gray-500 hover:text-red-500 transition-colors"
                >Aprobaciones</a
              >
            </li>
            <li th:if="${isAdmin}">
              <a
                href="/admin/tarifarios"
                class="text-[12px] font-medium text-gray-500 hover:text-apple-blue transition-colors"
                >Administrar</a
              >
            </li>
            <li th:if="${isAdmin}">
              <a
                href="/admin/validaciones"
                class="text-[12px] font-medium text-gray-500 hover:text-green-600 transition-colors"
                >Validar</a
              >
            </li>
          </ul>
        </div>
        <div class="flex items-center gap-4" th:if="${currentUser != null}">
          <div class="text-right">
            <p
              class="text-[10px] font-bold text-gray-400 uppercase tracking-widest leading-none mb-1"
              th:text="${isAdmin ? 'Admin' : 'Personal'}"
            >
              ROL
            </p>
            <p
              class="text-[13px] font-semibold text-gray-900 leading-none"
              th:text="${currentUser.nombreCompleto}"
            >
              Nombre
            </p>
          </div>
          <div
            class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center border border-gray-200"
          >
            <i data-lucide="user" class="w-4 h-4 text-gray-400"></i>
          </div>
        </div>
      </div>
    </nav>

    <main class="pt-32 pb-20 px-6">
      <div class="max-w-6xl mx-auto">
        <!-- Welcome Section -->
        <div
          class="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-12 animate-in fade-in slide-in-from-bottom-4 duration-500"
        >
          <div>
            <h1
              class="text-4xl md:text-5xl font-semibold tracking-tighter text-gray-900 mb-2"
            >
              Mis Solicitudes
            </h1>
            <p class="text-lg text-gray-500 font-medium max-w-lg">
              Gestiona tus comisiones de servicio y estados de viáticos en
              tiempo real.
            </p>
          </div>
          <a href="/solicitudes/nueva" class="btn-primary">
            <i data-lucide="plus" class="w-4 h-4"></i>
            Nueva Solicitud
          </a>
        </div>

        <!-- Dashboard estadisticas -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-10">
          <div
            class="card-pro p-6 bg-white flex items-center gap-4 overflow-hidden relative"
          >
            <div
              class="w-12 h-12 rounded-[18px] bg-blue-50 flex items-center justify-center"
            >
              <i data-lucide="send" class="w-5 h-5 text-apple-blue"></i>
            </div>
            <div>
              <p
                class="text-[10px] font-bold text-gray-400 uppercase tracking-widest pl-0.5 mb-1"
              >
                Total Enviadas
              </p>
              <p
                class="text-2xl font-bold tracking-tight text-gray-900"
                th:text="${#lists.size(solicitudes)}"
              >
                0
              </p>
            </div>
            <div class="absolute -right-4 -bottom-4 opacity-[0.03] rotate-12">
              <i data-lucide="file-text" class="w-24 h-24"></i>
            </div>
          </div>
          <div
            class="card-pro p-6 bg-white flex items-center gap-4 overflow-hidden relative"
          >
            <div
              class="w-12 h-12 rounded-[18px] bg-green-50 flex items-center justify-center"
            >
              <i data-lucide="check-circle" class="w-5 h-5 text-green-600"></i>
            </div>
            <div>
              <p
                class="text-[10px] font-bold text-gray-400 uppercase tracking-widest pl-0.5 mb-1"
              >
                Aprobadas
              </p>
              <p
                class="text-2xl font-bold tracking-tight text-gray-900"
                th:text="${#lists.size(solicitudes.?[estado.name() == 'APROBADO' || estado.name() == 'RENDIDO' || estado.name() == 'LIQUIDADO'])}"
              >
                0
              </p>
            </div>
          </div>
          <div
            class="card-pro p-5 bg-gray-900 text-white flex items-center justify-between group overflow-hidden relative"
          >
            <div class="relative z-10">
              <p
                class="text-gray-400 text-[10px] font-bold uppercase tracking-widest mb-1"
              >
                Rendición Pendiente
              </p>
              <p
                class="text-2xl font-bold tracking-tight"
                th:text="${#lists.size(solicitudes.?[estado.name() == 'APROBADO'])}"
              >
                0
              </p>
            </div>
            <div
              class="relative z-10 w-10 h-10 bg-white/10 rounded-full flex items-center justify-center"
            >
              <i data-lucide="clock" class="w-5 h-5 text-white/50"></i>
            </div>
            <div
              class="absolute top-0 right-0 w-24 h-24 bg-blue-500/10 blur-3xl rounded-full translate-x-12 -translate-y-12"
            ></div>
          </div>
        </div>

        <div class="card-pro overflow-hidden">
          <div class="overflow-x-auto">
            <table class="w-full text-sm">
              <thead>
                <tr class="bg-gray-50/50 border-b border-gray-100">
                  <th
                    class="px-8 py-5 text-left font-bold text-gray-400 text-[10px] uppercase tracking-widest"
                  >
                    ID
                  </th>
                  <th
                    class="px-8 py-5 text-left font-bold text-gray-400 text-[10px] uppercase tracking-widest"
                  >
                    Información de Viaje
                  </th>
                  <th
                    class="px-8 py-5 text-left font-bold text-gray-400 text-[10px] uppercase tracking-widest"
                  >
                    Fechas
                  </th>
                  <th
                    class="px-8 py-5 text-right font-bold text-gray-400 text-[10px] uppercase tracking-widest"
                  >
                    Presupuesto
                  </th>
                  <th
                    class="px-8 py-5 text-center font-bold text-gray-400 text-[10px] uppercase tracking-widest"
                  >
                    Estado
                  </th>
                  <th
                    class="px-8 py-5 text-right font-bold text-gray-400 text-[10px] uppercase tracking-widest"
                  >
                    Detalles
                  </th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-50">
                <tr
                  th:each="sol : ${solicitudes}"
                  class="group hover:bg-gray-50/80 transition-all duration-300"
                >
                  <td class="px-8 py-6">
                    <span
                      class="inline-flex items-center justify-center px-2 py-1 bg-gray-100 text-gray-500 text-[10px] font-bold rounded-lg group-hover:bg-black group-hover:text-white transition-colors"
                      th:text="${'#' + sol.id}"
                    >
                      #
                    </span>
                  </td>
                  <td class="px-8 py-6 whitespace-nowrap">
                    <div
                      class="font-bold text-gray-900 text-sm"
                      th:text="${sol.motivoViaje}"
                    >
                      Motivo
                    </div>
                    <div class="flex items-center gap-1.5 mt-1">
                      <i
                        data-lucide="map-pin"
                        class="w-3 h-3 text-gray-400"
                      ></i>
                      <span
                        class="text-[10px] text-gray-400 font-bold uppercase tracking-widest"
                        th:text="${sol.itinerarios[0].zonaDestino.nombre}"
                        >Zona</span
                      >
                    </div>
                  </td>
                  <td class="px-8 py-6 whitespace-nowrap">
                    <div
                      class="text-gray-600 font-medium text-[13px]"
                      th:text="${sol.fechaInicio + ' — ' + sol.fechaFin}"
                    >
                      Fecha
                    </div>
                    <div class="text-[11px] text-gray-400 mt-0.5">
                      Comisión Periodo
                    </div>
                  </td>
                  <td class="px-8 py-6 text-right">
                    <div
                      class="font-bold text-gray-900 text-sm tabular-nums"
                      th:text="${'S/ ' + #numbers.formatDecimal(sol.montoTotal, 1, 2)}"
                    >
                      0.00
                    </div>
                    <div
                      class="text-[10px] text-gray-400 font-semibold uppercase tracking-wider"
                    >
                      Total Viáticos
                    </div>
                  </td>
                  <td class="px-8 py-6 text-center">
                    <span
                      th:if="${sol.estado.name() == 'BORRADOR'}"
                      class="inline-flex items-center gap-1.5 px-3 py-1 bg-gray-100 text-gray-500 rounded-full text-[10px] font-bold uppercase tracking-wider"
                      >Borrador</span
                    >
                    <span
                      th:if="${sol.estado.name() == 'PENDIENTE'}"
                      class="inline-flex items-center gap-1.5 px-3 py-1 bg-amber-50 text-amber-600 border border-amber-100/50 rounded-full text-[10px] font-bold uppercase tracking-wider"
                      ><span
                        class="w-1.5 h-1.5 bg-amber-500 rounded-full animate-pulse"
                      ></span>
                      Pendiente</span
                    >
                    <span
                      th:if="${sol.estado.name() == 'APROBADO'}"
                      class="inline-flex items-center gap-1.5 px-3 py-1 bg-green-50 text-green-600 border border-green-100/50 rounded-full text-[10px] font-bold uppercase tracking-wider"
                      ><i data-lucide="check" class="w-3 h-3"></i>
                      Aprobado</span
                    >
                    <span
                      th:if="${sol.estado.name() == 'RECHAZADO'}"
                      class="inline-flex items-center gap-1.5 px-3 py-1 bg-red-50 text-red-600 border border-red-100/50 rounded-full text-[10px] font-bold uppercase tracking-wider"
                      ><i data-lucide="x" class="w-3 h-3"></i> Rechazado</span
                    >
                    <span
                      th:if="${sol.estado.name() == 'RENDIDO'}"
                      class="inline-flex items-center gap-1.5 px-3 py-1 bg-blue-50 text-blue-600 border border-blue-100/50 rounded-full text-[10px] font-bold uppercase tracking-wider"
                      ><i data-lucide="file-check" class="w-3 h-3"></i>
                      Rendido</span
                    >
                    <span
                      th:if="${sol.estado.name() == 'LIQUIDADO'}"
                      class="inline-flex items-center gap-1.5 px-3 py-2 bg-black text-white rounded-full text-[10px] font-bold uppercase tracking-widest shadow-lg shadow-black/10"
                      ><i
                        data-lucide="shield-check"
                        class="w-3 h-3 text-green-400"
                      ></i>
                      Liquidado</span
                    >
                    <span
                      th:if="${sol.estado.name() == 'CANCELADO'}"
                      class="inline-flex items-center gap-1.5 px-3 py-1 bg-gray-50 text-gray-400 italic rounded-full text-[10px] font-bold uppercase tracking-wider line-through"
                      >Cancelado</span
                    >

                    <div
                      th:if="${sol.estado.name() == 'RECHAZADO' && sol.comentarioRechazo != null}"
                      class="mt-2 text-[10px] text-red-400 italic font-medium leading-tight max-w-[140px] mx-auto bg-red-50/50 p-1.5 rounded-lg"
                      th:text="${'“' + sol.comentarioRechazo + '”'}"
                    ></div>
                  </td>
                  <td class="px-8 py-6 text-right">
                    <div class="flex justify-end items-center gap-4">
                      <!-- Botón Rendir   -->
                      <a
                        th:if="${sol.estado.name() == 'APROBADO'}"
                        th:href="@{'/rendiciones/solicitud/' + ${sol.id}}"
                        class="px-4 py-2 bg-apple-blue text-white text-[11px] font-bold uppercase tracking-wide rounded-full hover:bg-blue-600 transition-all shadow-lg shadow-blue-500/20 active:scale-95 flex items-center gap-1.5"
                      >
                        Rendir
                      </a>

                      <!-- Botón Enviar   -->
                      <form
                        th:if="${sol.estado.name() == 'BORRADOR'}"
                        th:action="@{'/solicitudes/enviar/' + ${sol.id}}"
                        method="post"
                      >
                        <button
                          type="submit"
                          class="px-4 py-2 bg-black text-white text-[11px] font-bold uppercase tracking-wide rounded-full hover:bg-gray-800 transition-all shadow-lg active:scale-95"
                        >
                          Enviar
                        </button>
                      </form>

                      <!-- Ver Detalle -->
                      <a
                        th:href="@{'/solicitudes/' + ${sol.id}}"
                        class="w-10 h-10 bg-gray-100 text-gray-400 hover:text-apple-blue hover:bg-blue-50 transition-all flex items-center justify-center rounded-xl group-hover:shadow-sm"
                      >
                        <i
                          data-lucide="chevron-right"
                          class="w-5 h-5 group-hover:translate-x-0.5 transition-transform"
                        ></i>
                      </a>
                    </div>
                  </td>
                </tr>

                <!-- contenido vacio -->
                <tr th:if="${#lists.isEmpty(solicitudes)}">
                  <td colspan="6" class="px-8 py-32 text-center">
                    <div
                      class="flex flex-col items-center justify-center max-w-sm mx-auto"
                    >
                      <div
                        class="w-20 h-20 bg-gray-50 rounded-[28px] flex items-center justify-center mb-6"
                      >
                        <i
                          data-lucide="file-question"
                          class="w-10 h-10 text-gray-200"
                        ></i>
                      </div>
                      <h3 class="text-xl font-bold text-gray-900 mb-2">
                        Sin solicitudes todavía
                      </h3>
                      <p class="text-gray-500 text-sm font-medium mb-8">
                        Parece que aún no has registrado ninguna comisión de
                        servicio.
                      </p>
                      <a href="/solicitudes/nueva" class="btn-primary">
                        Comenzar ahora
                      </a>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    <script th:inline="javascript">
      lucide.createIcons();
    </script>
  </body>
</html>
