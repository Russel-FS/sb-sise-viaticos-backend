<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mis Solicitudes - ISS Viáticos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: [
                "-apple-system",
                "BlinkMacSystemFont",
                '"SF Pro Display"',
                '"SF Pro Text"',
                "Helvetica Neue",
                "Arial",
                "sans-serif",
              ],
            },
            colors: {
              apple: {
                bg: "#f5f5f7",
                card: "#ffffff",
                text: "#1d1d1f",
                secondary: "#86868b",
                blue: "#0071e3",
                border: "rgba(0, 0, 0, 0.05)",
              },
            },
          },
        },
      };
    </script>
    <style>
      body {
        background-color: #f5f5f7;
        color: #1d1d1f;
        letter-spacing: -0.015em;
      }
      .glass {
        background: rgba(255, 255, 255, 0.72);
        backdrop-filter: saturate(180%) blur(20px);
        border-bottom: 1px solid rgba(0, 0, 0, 0.04);
      }
      .apple-card-refined {
        background: #ffffff;
        border-radius: 28px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.01);
      }
    </style>
  </head>
  <body class="antialiased selection:bg-apple-blue selection:text-white pb-20">
    <!-- Nav -->
    <nav class="fixed top-0 w-full z-50 glass">
      <div
        class="max-w-6xl mx-auto px-8 h-12 flex items-center justify-between"
      >
        <div class="flex items-center gap-10">
          <a href="/" class="text-[14px] font-bold tracking-tight text-gray-900"
            >ISS Viáticos</a
          >
          <ul class="hidden md:flex gap-8 list-none">
            <li>
              <a
                href="/solicitudes"
                class="text-[12px] font-bold text-apple-blue"
                >Solicitudes</a
              >
            </li>
            <li th:if="${isAdmin}">
              <a
                href="/admin/aprobaciones"
                class="text-[12px] font-medium text-gray-500 hover:text-black transition-colors"
                >Aprobaciones</a
              >
            </li>
            <li th:if="${isAdmin}">
              <a
                href="/admin/tarifarios"
                class="text-[12px] font-medium text-gray-500 hover:text-black transition-colors"
                >Administrar</a
              >
            </li>
            <li th:if="${isAdmin}">
              <a
                href="/admin/validaciones"
                class="text-[12px] font-medium text-green-600 hover:text-green-800 transition-colors"
                >Validar</a
              >
            </li>
          </ul>
        </div>
        <div class="flex items-center gap-6" th:if="${currentUser != null}">
          <div class="text-right">
            <p
              class="text-[9px] font-bold text-apple-secondary uppercase tracking-[0.1em] block mb-0.5"
              th:text="${isAdmin ? 'ADMIN' : 'PERSONAL'}"
            >
              ROL
            </p>
            <p
              class="text-[12px] font-bold text-gray-900 leading-none"
              th:text="${currentUser.nombreCompleto}"
            >
              Nombre
            </p>
          </div>
          <div
            class="w-8 h-8 rounded-full bg-apple-bg flex items-center justify-center border border-gray-100"
          >
            <i data-lucide="user" class="w-4 h-4 text-gray-400"></i>
          </div>
        </div>
      </div>
    </nav>

    <main class="pt-32 px-8">
      <div class="max-w-6xl mx-auto">
        <!-- Header Section -->
        <div
          class="flex flex-col md:flex-row md:items-end justify-between gap-6 mb-12 animate-in fade-in slide-in-from-bottom-4 duration-700"
        >
          <div>
            <h1 class="text-4xl font-bold tracking-tight text-gray-900 mb-2">
              Mis Solicitudes
            </h1>
            <p class="text-lg text-apple-secondary font-medium">
              Historial de comisiones y estados de viáticos.
            </p>
          </div>
          <a
            href="/solicitudes/nueva"
            class="px-6 py-3 bg-black text-white text-sm font-bold rounded-full hover:bg-gray-800 transition-all active:scale-95 shadow-lg shadow-black/5 flex items-center gap-2"
          >
            <i data-lucide="plus" class="w-4 h-4"></i>
            Nueva Solicitud
          </a>
        </div>

        <!-- Dashboard Stats Neutros -->
        <div class="grid grid-cols-1 sm:grid-cols-3 gap-8 mb-12">
          <div
            class="apple-card-refined p-8 flex items-center gap-6 relative overflow-hidden group"
          >
            <div
              class="text-gray-900 group-hover:scale-110 transition-transform duration-500"
            >
              <i data-lucide="send" class="w-8 h-8"></i>
            </div>
            <div>
              <p
                class="text-[10px] font-bold text-apple-secondary uppercase tracking-[0.1em] mb-1"
              >
                Total Enviadas
              </p>
              <p
                class="text-3xl font-bold tracking-tighter text-gray-900"
                th:text="${#lists.size(solicitudes)}"
              >
                0
              </p>
            </div>
          </div>
          <div
            class="apple-card-refined p-8 flex items-center gap-6 relative overflow-hidden group"
          >
            <div
              class="text-gray-900 group-hover:scale-110 transition-transform duration-500"
            >
              <i data-lucide="check-circle" class="w-8 h-8"></i>
            </div>
            <div>
              <p
                class="text-[10px] font-bold text-apple-secondary uppercase tracking-[0.1em] mb-1"
              >
                Aprobadas
              </p>
              <p
                class="text-3xl font-bold tracking-tighter text-gray-900"
                th:text="${#lists.size(solicitudes.?[estado.name() == 'APROBADO' || estado.name() == 'RENDIDO' || estado.name() == 'LIQUIDADO'])}"
              >
                0
              </p>
            </div>
          </div>
          <div
            class="apple-card-refined p-8 flex items-center justify-between group overflow-hidden relative border border-black/[0.03]"
          >
            <div class="flex items-center gap-6">
              <div
                class="text-gray-900 group-hover:scale-110 transition-transform duration-500"
              >
                <i data-lucide="clock" class="w-8 h-8"></i>
              </div>
              <div>
                <p
                  class="text-[10px] font-bold text-apple-secondary uppercase tracking-[0.1em] mb-1"
                >
                  Por Rendir
                </p>
                <p
                  class="text-3xl font-bold tracking-tighter text-gray-900"
                  th:text="${#lists.size(solicitudes.?[estado.name() == 'APROBADO'])}"
                >
                  0
                </p>
              </div>
            </div>
          </div>
        </div>

        <!-- Tabla-->
        <div class="apple-card-refined overflow-hidden mb-20">
          <div class="overflow-x-auto">
            <table class="w-full text-left">
              <thead>
                <tr class="border-b border-gray-50">
                  <th
                    class="px-10 py-6 text-[10px] font-bold text-gray-400 uppercase tracking-widest pl-10"
                  >
                    ID
                  </th>
                  <th
                    class="px-10 py-6 text-[10px] font-bold text-gray-400 uppercase tracking-widest"
                  >
                    Información
                  </th>
                  <th
                    class="px-10 py-6 text-[10px] font-bold text-gray-400 uppercase tracking-widest"
                  >
                    Periodo
                  </th>
                  <th
                    class="px-10 py-6 text-[10px] font-bold text-gray-400 uppercase tracking-widest text-right"
                  >
                    Presupuesto
                  </th>
                  <th
                    class="px-10 py-6 text-[10px] font-bold text-gray-400 uppercase tracking-widest text-center"
                  >
                    Estado
                  </th>
                  <th class="px-10 py-6"></th>
                </tr>
              </thead>
              <tbody class="divide-y divide-gray-50">
                <tr
                  th:each="sol : ${solicitudes}"
                  class="group hover:bg-gray-50/50 transition-colors"
                >
                  <td class="px-10 py-8">
                    <span
                      class="text-[13px] font-bold text-gray-300 group-hover:text-black transition-colors"
                      th:text="${'#' + sol.id}"
                    >
                      #
                    </span>
                  </td>
                  <td class="px-10 py-8">
                    <div
                      class="font-bold text-gray-900 text-sm mb-1"
                      th:text="${sol.motivoViaje}"
                    >
                      Motivo
                    </div>
                    <div class="flex items-center gap-1.5">
                      <i
                        data-lucide="navigation"
                        class="w-3 h-3 text-gray-300"
                      ></i>
                      <span
                        class="text-[11px] text-gray-400 font-medium"
                        th:text="${sol.itinerarios[0].zonaDestino.nombre}"
                        >Zona</span
                      >
                    </div>
                  </td>
                  <td class="px-10 py-8 whitespace-nowrap">
                    <div
                      class="text-gray-600 font-medium text-[13px]"
                      th:text="${sol.fechaInicio + ' — ' + sol.fechaFin}"
                    >
                      Fecha
                    </div>
                  </td>
                  <td class="px-10 py-8 text-right">
                    <div
                      class="font-bold text-gray-900 text-sm tabular-nums"
                      th:text="${'S/ ' + #numbers.formatDecimal(sol.montoTotal, 1, 2)}"
                    >
                      0.00
                    </div>
                  </td>
                  <td class="px-10 py-8 text-center">
                    <span
                      th:if="${sol.estado.name() == 'BORRADOR'}"
                      class="px-3 py-1 bg-gray-100 text-gray-500 rounded-full text-[10px] font-bold uppercase tracking-wider"
                      >Borrador</span
                    >
                    <span
                      th:if="${sol.estado.name() == 'PENDIENTE'}"
                      class="px-3 py-1 bg-amber-50 text-amber-600 rounded-full text-[10px] font-bold uppercase tracking-wider"
                      >Pendiente</span
                    >
                    <span
                      th:if="${sol.estado.name() == 'APROBADO'}"
                      class="px-3 py-1 bg-green-50 text-green-600 rounded-full text-[10px] font-bold uppercase tracking-wider"
                      >Aprobado</span
                    >
                    <span
                      th:if="${sol.estado.name() == 'RECHAZADO'}"
                      class="px-3 py-1 bg-red-50 text-red-600 rounded-full text-[10px] font-bold uppercase tracking-wider"
                      >Rechazado</span
                    >
                    <span
                      th:if="${sol.estado.name() == 'RENDIDO'}"
                      class="px-3 py-1 bg-blue-50 text-apple-blue rounded-full text-[10px] font-bold uppercase tracking-wider"
                      >Rendido</span
                    >
                    <span
                      th:if="${sol.estado.name() == 'LIQUIDADO'}"
                      class="px-3 py-2 bg-black text-white rounded-full text-[10px] font-bold uppercase tracking-widest shadow-sm"
                      >Liquidado</span
                    >
                    <span
                      th:if="${sol.estado.name() == 'CANCELADO'}"
                      class="px-3 py-1 bg-gray-50 text-gray-400 rounded-full text-[10px] font-bold uppercase tracking-wider line-through"
                      >Cancelado</span
                    >
                  </td>
                  <td class="px-10 py-8 text-right">
                    <div class="flex justify-end items-center gap-4">
                      <!-- Botón Rendir -->
                      <a
                        th:if="${sol.estado.name() == 'APROBADO'}"
                        th:href="@{'/rendiciones/solicitud/' + ${sol.id}}"
                        class="px-4 py-2 bg-apple-blue text-white text-[11px] font-bold uppercase tracking-wide rounded-full hover:bg-blue-600 transition-all active:scale-95 shadow-lg shadow-blue-500/10"
                      >
                        Rendir
                      </a>
                      <!-- Botón Enviar -->
                      <form
                        th:if="${sol.estado.name() == 'BORRADOR'}"
                        th:action="@{'/solicitudes/enviar/' + ${sol.id}}"
                        method="post"
                      >
                        <button
                          type="submit"
                          class="px-4 py-2 bg-black text-white text-[11px] font-bold uppercase tracking-wide rounded-full hover:bg-gray-800 transition-all active:scale-95"
                        >
                          Enviar
                        </button>
                      </form>
                      <!-- Ver Detalle -->
                      <a
                        th:href="@{'/solicitudes/' + ${sol.id}}"
                        class="inline-flex items-center justify-center w-10 h-10 rounded-full bg-apple-bg text-gray-400 hover:bg-black hover:text-white transition-all transform hover:scale-105"
                      >
                        <i data-lucide="chevron-right" class="w-4 h-4"></i>
                      </a>
                    </div>
                  </td>
                </tr>

                <!-- Contenido vacío -->
                <tr th:if="${#lists.isEmpty(solicitudes)}">
                  <td colspan="6" class="px-10 py-32 text-center">
                    <div class="flex flex-col items-center justify-center">
                      <i
                        data-lucide="inbox"
                        class="w-12 h-12 text-gray-100 mb-6"
                      ></i>
                      <h3 class="text-xl font-bold text-gray-900 mb-2">
                        Sin solicitudes
                      </h3>
                      <p class="text-gray-400 text-sm font-medium mb-8">
                        No hemos encontrado registros para mostrar.
                      </p>
                      <a
                        href="/solicitudes/nueva"
                        class="px-6 py-3 bg-black text-white text-[13px] font-bold rounded-full"
                      >
                        Nueva Solicitud
                      </a>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </main>

    <script th:inline="javascript">
      lucide.createIcons();
    </script>
  </body>
</html>
