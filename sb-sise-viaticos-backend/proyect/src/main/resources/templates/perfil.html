<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mi Cuenta - ISS Viáticos</title>

    <!-- Fuentes y Recursos -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@300;400;500;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Configuración del Tema -->
    <script>
      (function () {
        const savedTheme = localStorage.getItem("theme");
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;
        if (savedTheme === "dark" || (!savedTheme && prefersDark)) {
          document.documentElement.classList.add("dark");
        }
      })();
    </script>
    <th:block th:replace="~{fragments/theme :: themeStyles}"></th:block>
    <th:block th:replace="~{fragments/nav :: styles}"></th:block>

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              serif: ['"Instrument Serif"', "serif"],
              sans: ['"Inter"', "sans-serif"],
            },
            colors: {
              surface: { light: "#FFFFFF", dark: "#1C1E22" },
              accent: {
                sage: "#D8E2DC",
                forest: "#2D3B2D",
                clay: "#C4A484",
              },
            },
          },
        },
      };
    </script>

    <style>
      body {
        background-color: #f5f5f7;
        color: #1d1d1f;
        -webkit-font-smoothing: antialiased;
      }
      .dark body {
        background-color: #000000;
        color: #f5f5f7;
      }

      /* Animaciones */
      @keyframes fade-in-up {
        from {
          opacity: 0;
          transform: translateY(15px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      .animate-enter {
        animation: fade-in-up 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        opacity: 0;
      }

      .settings-card {
        background: white;
        border-radius: 16px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        overflow: hidden;
      }
      .dark .settings-card {
        background: #1c1c1e;
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      .settings-input-group {
        display: flex;
        align-items: center;
        padding: 1rem 1.25rem;
        background: white;
        border-bottom: 1px solid #e5e5ea;
        transition: background-color 0.2s;
      }
      .dark .settings-input-group {
        background: #1c1c1e;
        border-bottom: 1px solid #38383a;
      }
      .settings-input-group:last-child {
        border-bottom: none;
      }
      .settings-label {
        width: 140px;
        font-weight: 500;
        color: #1c1c1e;
      }
      .dark .settings-label {
        color: #e5e5e7;
      }
      .settings-input {
        flex: 1;
        background: transparent;
        border: none;
        outline: none;
        text-align: right;
        color: #3a3a3c;
        font-size: 0.95rem;
      }
      .dark .settings-input {
        color: #8e8e93;
      }
      .settings-input:focus {
        color: #007aff;
      }
      .dark .settings-input:focus {
        color: #0a84ff;
      }
      .settings-input::placeholder {
        color: #c7c7cc;
      }
      .dark .settings-input::placeholder {
        color: #636366;
      }

      .settings-input[readonly] {
        color: #8e8e93;
        cursor: default;
      }
      .dark .settings-input[readonly] {
        color: #636366;
      }

      .passport-header {
        background: linear-gradient(135deg, #e5e5ea 0%, #f2f2f7 100%);
      }
      .dark .passport-header {
        background: linear-gradient(135deg, #1c1c1e 0%, #2c2c2e 100%);
      }
    </style>
  </head>
  <body
    class="antialiased min-h-screen pb-20 selection:bg-accent-sage selection:text-accent-forest"
  >
    <!-- Navegación -->
    <th:block
      th:replace="~{fragments/nav :: navbar(activeTab='perfil')}"
    ></th:block>

    <!-- Notificaciones -->
    <th:block th:replace="~{fragments/common :: toaster}"></th:block>

    <main class="pt-28 px-4 md:px-0 max-w-2xl mx-auto space-y-6">
      <div class="animate-enter" style="animation-delay: 0ms">
        <h1 class="text-3xl font-bold mb-6 ml-2 dark:text-white">
          Configuración
        </h1>

        <div
          class="settings-card flex flex-col md:flex-row items-center p-6 gap-6 passport-header"
        >
          <!-- Avatar -->
          <div class="relative shrink-0">
            <div
              class="w-24 h-24 rounded-full bg-gradient-to-tr from-[#111114] to-[#636366] dark:from-[#3A3A3C] dark:to-[#1C1C1E] flex items-center justify-center text-white text-3xl font-bold shadow-xl ring-4 ring-white dark:ring-[#1C1C1E]"
            >
              <span
                th:text="${#strings.substring(empleado.nombres,0,1) + #strings.substring(empleado.apellidos,0,1)}"
                >US</span
              >
            </div>
            <div
              class="absolute bottom-1 right-1 w-6 h-6 bg-green-500 rounded-full border-4 border-white dark:border-[#2C2C2E]"
              title="Activo"
            ></div>
          </div>

          <!-- Info -->
          <div class="text-center md:text-left flex-1 min-w-0">
            <h2
              class="text-2xl font-bold text-gray-900 dark:text-white leading-tight mb-1"
              th:text="${empleado.nombres + ' ' + empleado.apellidos}"
            >
              Nombre del Usuario
            </h2>
            <p
              class="text-gray-500 dark:text-gray-400 font-medium mb-3"
              th:text="${currentUser.username}"
            >
              @usuario
            </p>

            <div class="flex flex-wrap justify-center md:justify-start gap-2">
              <th:block th:each="roleName : ${currentUser.roleNames}">
                <span
                  class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-white/50 dark:bg-white/10 text-xs font-semibold uppercase tracking-wider text-gray-600 dark:text-gray-300 backdrop-blur-sm border border-black/5 dark:border-white/5"
                >
                  <i data-lucide="shield" class="w-3 h-3"></i>
                  <span th:text="${roleName}">ROL</span>
                </span>
              </th:block>
              <span
                class="inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-white/50 dark:bg-white/10 text-xs font-semibold uppercase tracking-wider text-gray-600 dark:text-gray-300 backdrop-blur-sm border border-black/5 dark:border-white/5"
              >
                <i data-lucide="bar-chart-3" class="w-3 h-3"></i>
                <span th:text="${empleado.nivel.nombre}">NIVEL</span>
              </span>
            </div>
          </div>
        </div>
      </div>

      <form th:action="@{/perfil/actualizar}" method="post" class="space-y-6">
        <!-- informacion personal-->
        <div class="animate-enter" style="animation-delay: 100ms">
          <h3
            class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-widest ml-4 mb-2"
          >
            Información Personal
          </h3>
          <div class="settings-card">
            <div class="settings-input-group">
              <label class="settings-label">DNI</label>
              <input
                type="text"
                class="settings-input"
                th:value="${empleado.dni}"
                readonly
              />
            </div>
            <div class="settings-input-group">
              <label class="settings-label">Nombres</label>
              <input
                type="text"
                class="settings-input"
                th:value="${empleado.nombres}"
                readonly
              />
            </div>
            <div class="settings-input-group">
              <label class="settings-label">Apellidos</label>
              <input
                type="text"
                class="settings-input"
                th:value="${empleado.apellidos}"
                readonly
              />
            </div>
          </div>
          <p class="text-[11px] text-gray-400 dark:text-gray-500 ml-4 mt-2">
            Para modificar estos datos, contacte a Recursos Humanos.
          </p>
        </div>

        <!-- contacto y pago -->
        <div class="animate-enter" style="animation-delay: 200ms">
          <h3
            class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-widest ml-4 mb-2"
          >
            Contacto y Pagos
          </h3>
          <div class="settings-card">
            <div class="settings-input-group">
              <label class="settings-label">Email</label>
              <input
                type="email"
                name="email"
                class="settings-input"
                th:value="${empleado.email}"
                required
                placeholder="ejemplo@correo.com"
              />
            </div>
            <div class="settings-input-group">
              <label class="settings-label">Cta. Bancaria</label>
              <input
                type="text"
                name="cuentaBancaria"
                class="settings-input font-mono"
                th:value="${empleado.cuentaBancaria}"
                placeholder="000-000-000000"
              />
            </div>
          </div>
        </div>

        <!-- seguridad -->
        <div
          class="animate-enter"
          style="animation-delay: 300ms"
          x-data="{ changingPassword: false }"
        >
          <h3
            class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-widest ml-4 mb-2"
          >
            Seguridad
          </h3>
          <div class="settings-card">
            <!-- contraseña -->
            <div
              class="settings-input-group cursor-pointer hover:bg-gray-50 dark:hover:bg-white/5 transition-colors"
              @click="changingPassword = !changingPassword"
            >
              <label
                class="settings-label text-blue-600 dark:text-blue-400 cursor-pointer"
                >Contraseña</label
              >
              <div class="flex-1 text-right">
                <span
                  x-text="changingPassword ? 'Cancelar' : 'Cambiar'"
                  class="text-sm text-gray-400"
                  >Cambiar</span
                >
              </div>
              <i
                data-lucide="chevron-right"
                class="w-4 h-4 text-gray-300 ml-2 transition-transform duration-300"
                :class="changingPassword ? 'rotate-90' : ''"
              ></i>
            </div>

            <!-- contraseña -->
            <div x-show="changingPassword" x-collapse style="display: none">
              <div class="settings-input-group bg-gray-50/50 dark:bg-black/20">
                <label class="settings-label">Actual</label>
                <input
                  type="password"
                  name="currentPassword"
                  class="settings-input"
                  placeholder="Requerido"
                  :required="changingPassword"
                />
              </div>
              <div class="settings-input-group bg-gray-50/50 dark:bg-black/20">
                <label class="settings-label">Nueva</label>
                <input
                  type="password"
                  name="newPassword"
                  class="settings-input"
                  placeholder="Mín. 8 caracteres"
                  :required="changingPassword"
                />
              </div>
              <div class="settings-input-group bg-gray-50/50 dark:bg-black/20">
                <label class="settings-label">Confirmar</label>
                <input
                  type="password"
                  name="confirmPassword"
                  class="settings-input"
                  placeholder="Repetir nueva"
                  :required="changingPassword"
                />
              </div>
            </div>
          </div>
        </div>

        <!-- guardar cambios -->
        <div
          class="pt-4 flex justify-end animate-enter"
          style="animation-delay: 400ms"
        >
          <button
            type="submit"
            class="px-6 py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-full shadow-lg hover:scale-105 transition-all duration-300 flex items-center gap-2"
          >
            <i data-lucide="check" class="w-4 h-4"></i>
            Guardar Cambios
          </button>
        </div>
      </form>
    </main>

    <!-- Alpine.js -->
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"
    ></script>
    <script
      defer
      src="https://cdn.jsdelivr.net/npm/@alpinejs/collapse@3.x.x/dist/cdn.min.js"
    ></script>

    <script th:inline="javascript">
      lucide.createIcons();
    </script>
    <th:block th:replace="~{fragments/theme :: themeScript}"></th:block>
  </body>
</html>
