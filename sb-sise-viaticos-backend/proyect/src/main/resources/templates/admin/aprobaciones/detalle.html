<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Detalle de Solicitud - Aprobaciones</title>

    <!-- Fuentes y Recursos -->

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Configuración del Tema -->
    <script>
      (function () {
        const savedTheme = localStorage.getItem("theme");
        const prefersDark = window.matchMedia(
          "(prefers-color-scheme: dark)"
        ).matches;
        if (savedTheme === "dark" || (!savedTheme && prefersDark)) {
          document.documentElement.classList.add("dark");
        }
      })();
    </script>
    <th:block th:replace="~{fragments/theme :: themeStyles}"></th:block>

    <script>
      tailwind.config = {
        darkMode: "class",
        theme: {
          extend: {
            fontFamily: {
              serif: ['"Instrument Serif"', "serif"],
              sans: ['"Inter"', "sans-serif"],
            },
            colors: {
              background: { light: "#F9F8F6", dark: "#0F1115" },
              surface: { light: "#FFFFFF", dark: "#1C1E22" },
              accent: {
                sage: "#D8E2DC",
                forest: "#2D3B2D",
                clay: "#C4A484",
                hims: "#E63946",
              },
            },
            boxShadow: {
              neumorphic: "20px 20px 60px #d1d1d1, -20px -20px 60px #ffffff",
              "glass-lg": "0 8px 32px 0 rgba(31, 38, 135, 0.07)",
            },
          },
        },
      };
    </script>

    <style>
      body {
        background-color: #f5f5f7;
        color: #1d1d1f;
        -webkit-font-smoothing: antialiased;
      }
      .dark body {
        background-color: #000000;
        color: #f5f5f7;
      }

      .bento-card {
        background: white;
        border-radius: 24px;
        border: 1px solid rgba(0, 0, 0, 0.03);
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.01),
          0 4px 12px rgba(0, 0, 0, 0.03);
      }
      .dark .bento-card {
        background: #1c1e22;
        border: 1px solid rgba(255, 255, 255, 0.05);
      }

      /* Scrollbar Moderno */
      .custom-scroll::-webkit-scrollbar {
        width: 4px;
      }
      .custom-scroll::-webkit-scrollbar-track {
        background: transparent;
      }
      .custom-scroll::-webkit-scrollbar-thumb {
        background: rgba(0, 0, 0, 0.1);
        border-radius: 10px;
      }
      .dark .custom-scroll::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.1);
      }
      .custom-scroll::-webkit-scrollbar-thumb:hover {
        background: rgba(0, 0, 0, 0.2);
      }
      .dark .custom-scroll::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.2);
      }
    </style>
  </head>
  <body
    class="antialiased min-h-screen pb-20 selection:bg-accent-sage selection:text-accent-forest"
  >
    <!-- Botón Volver Flotante -->
    <a
      href="/admin/aprobaciones"
      class="fixed top-6 left-6 z-50 p-3 bg-white dark:bg-white/10 rounded-full shadow-lg hover:scale-105 transition-transform text-gray-900 dark:text-white"
      title="Volver"
    >
      <i data-lucide="arrow-left" class="w-5 h-5"></i>
    </a>

    <main class="pt-24 px-6 md:px-12 max-w-5xl mx-auto">
      <!-- Header -->
      <div class="mb-12 text-center">
        <span
          class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-accent-sage/30 text-accent-forest dark:text-accent-sage text-xs font-bold uppercase tracking-wider mb-4 border border-accent-sage/20"
        >
          Solicitud #<span th:text="${solicitud.id}">000</span>
        </span>
        <h1
          class="text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-4 leading-tight"
          th:text="${solicitud.motivoViaje}"
        >
          Motivo del Viaje
        </h1>
        <div
          class="flex items-center justify-center gap-2 text-lg text-gray-500 dark:text-gray-400"
        >
          <span
            th:text="${solicitud.empleado.nombres + ' ' + solicitud.empleado.apellidos}"
            >Empleado</span
          >
          <span>•</span>
          <span th:text="${solicitud.empleado.nivel.nombre}">Nivel</span>
        </div>
      </div>

      <!-- Grid de Información -->
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <!-- Fechas y Destino -->
        <div class="bento-card p-6 md:col-span-2">
          <h3 class="text-xl font-bold text-gray-900 dark:text-white mb-6">
            Itinerario
          </h3>

          <div class="space-y-6">
            <div
              th:each="itinerario, iterStat : ${solicitud.itinerarios}"
              class="relative pl-8 border-l-2 border-dashed border-gray-200 dark:border-white/10 last:border-0"
            >
              <div
                class="absolute -left-[9px] top-0 w-4 h-4 rounded-full bg-accent-sage dark:bg-accent-forest border-2 border-white dark:border-[#1C1E22]"
              ></div>

              <div
                class="flex flex-col md:flex-row md:items-center justify-between gap-4"
              >
                <div class="flex flex-col gap-4">
                  <div>
                    <p
                      class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1"
                    >
                      Destino <span th:text="${iterStat.count}">1</span>
                    </p>
                    <p
                      class="text-lg font-bold text-gray-900 dark:text-white"
                      th:text="${itinerario.zonaDestino.nombre + ' (' + itinerario.ciudadEspecifica + ')'}"
                    >
                      Ciudad
                    </p>
                  </div>

                  <!-- Desglose de Gastos/Tarifario (Lista Integrada) -->
                  <div class="mt-4">
                    <div class="mb-3 px-1 flex items-center justify-between">
                      <span
                        class="text-[10px] font-bold text-gray-400 uppercase tracking-[0.2em]"
                        >Desglose de Tarifas</span
                      >
                    </div>

                    <div
                      class="max-h-64 overflow-y-auto custom-scroll pr-2 space-y-2"
                    >
                      <div
                        th:each="tarifa : ${itinerario.tarifas}"
                        class="flex items-center justify-between p-3 rounded-2xl bg-gray-50/50 dark:bg-white/[0.02] border border-transparent hover:border-gray-100 dark:hover:border-white/5 transition-all group"
                      >
                        <div class="flex items-center gap-4">
                          <div
                            class="w-10 h-10 rounded-xl bg-white dark:bg-white/5 shadow-sm flex items-center justify-center text-gray-400 group-hover:scale-110 transition-transform duration-300"
                          >
                            <i data-lucide="receipt" class="w-5 h-5"></i>
                          </div>
                          <div>
                            <p
                              class="text-sm font-bold text-gray-900 dark:text-white mb-0.5"
                              th:text="${tarifa.tipoGasto.nombre}"
                            >
                              Concepto
                            </p>
                            <div class="flex items-center gap-2">
                              <span
                                class="text-[10px] px-1.5 py-0.5 rounded bg-gray-100 dark:bg-white/10 text-gray-500 dark:text-gray-400 font-bold uppercase tracking-tight"
                                th:text="${tarifa.tipoGasto.esAsignablePorDia ? 'Variable' : 'Fijo'}"
                                >Fijo</span
                              >
                              <span
                                class="text-xs text-gray-400 font-medium"
                                th:text="${tarifa.tipoGasto.esAsignablePorDia ? 'S/ ' + #numbers.formatDecimal(tarifa.monto, 1, 'COMMA', 2, 'POINT') + ' / día' : 'S/ ' + #numbers.formatDecimal(tarifa.monto, 1, 'COMMA', 2, 'POINT')}"
                                >0.00</span
                              >
                            </div>
                          </div>
                        </div>

                        <div class="text-right">
                          <p
                            class="text-sm font-mono font-bold text-gray-900 dark:text-white bg-gray-100/50 dark:bg-white/5 px-2 py-1 rounded-lg"
                            th:text="${tarifa.tipoGasto.esAsignablePorDia ? 'S/ ' + #numbers.formatDecimal(tarifa.monto * itinerario.noches, 1, 'COMMA', 2, 'POINT') : 'S/ ' + #numbers.formatDecimal(tarifa.monto, 1, 'COMMA', 2, 'POINT')}"
                          >
                            0.00
                          </p>
                          <p
                            class="text-[9px] text-gray-400 font-bold tracking-widest uppercase mt-1"
                            th:text="${tarifa.tipoGasto.esAsignablePorDia ? itinerario.noches + ' Noches' : 'Monto Fijo'}"
                          >
                            0 noches
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="text-right">
                  <span
                    class="inline-block px-3 py-1 rounded-lg bg-gray-100 dark:bg-white/5 text-sm font-medium text-gray-600 dark:text-gray-300"
                    th:text="${itinerario.noches + ' Noches'}"
                  >
                    0 Noches
                  </span>
                </div>
              </div>
            </div>
          </div>

          <div
            class="mt-8 pt-6 border-t border-gray-100 dark:border-white/5 flex items-center justify-between"
          >
            <div>
              <p
                class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1"
              >
                Salida
              </p>
              <p
                class="font-medium text-gray-900 dark:text-white"
                th:text="${solicitud.fechaInicio}"
              >
                Fecha
              </p>
            </div>
            <div class="text-right">
              <p
                class="text-xs font-bold text-gray-400 uppercase tracking-widest mb-1"
              >
                Retorno
              </p>
              <p
                class="font-medium text-gray-900 dark:text-white"
                th:text="${solicitud.fechaFin}"
              >
                Fecha
              </p>
            </div>
          </div>
        </div>

        <!-- Resumen Financiero -->
        <div
          class="bento-card p-6 bg-accent-forest text-white overflow-hidden relative"
        >
          <!-- Decoración de fondo -->
          <div
            class="absolute -top-10 -right-10 w-40 h-40 bg-white/5 rounded-full blur-3xl"
          ></div>

          <div class="relative z-10">
            <h3
              class="text-xl font-bold mb-6 opacity-90 flex items-center gap-2"
            >
              <i data-lucide="wallet" class="w-5 h-5 opacity-70"></i>
              Presupuesto
            </h3>

            <div class="space-y-4 mb-8">
              <div class="flex justify-between items-center">
                <span
                  class="text-xs opacity-60 uppercase tracking-widest font-bold"
                  >Estado</span
                >
                <span
                  class="px-3 py-1 bg-white/10 rounded-full text-[10px] font-bold tracking-tighter uppercase"
                  th:text="${solicitud.estado}"
                  >ESTADO</span
                >
              </div>

              <div class="my-4 border-t border-white/10"></div>

              <div class="flex flex-col gap-1">
                <span
                  class="text-xs opacity-60 uppercase tracking-widest font-bold"
                  >Total Estimado</span
                >
                <div class="flex items-end gap-2">
                  <span
                    class="text-3xl font-mono font-bold tracking-tight"
                    th:text="${'S/ ' + #numbers.formatDecimal(solicitud.montoTotal, 1, 'COMMA', 2, 'POINT')}"
                    >0.00</span
                  >
                  <span class="text-xs opacity-50 mb-1">PEN</span>
                </div>
              </div>
            </div>

            <div class="p-4 bg-white/5 rounded-2xl border border-white/10">
              <p class="text-[10px] opacity-70 leading-relaxed">
                <i data-lucide="info" class="w-3 h-3 inline-block mr-1"></i>
                Los montos son calculados automáticamente según las tarifas
                vigentes por cargo y zona geográfica asignada.
              </p>
            </div>
          </div>
        </div>
      </div>

      <!-- Acciones -->
      <div
        class="flex flex-col md:flex-row gap-4 justify-center items-center mt-12 pb-12"
      >
        <button
          th:data-id="${solicitud.id}"
          th:data-nombre="${solicitud.empleado.nombres}"
          onclick="btnAbrirModalRechazar(this)"
          class="w-full md:w-auto px-8 py-4 rounded-full border border-red-200 dark:border-red-900/30 text-red-600 dark:text-red-400 font-bold hover:bg-red-50 dark:hover:bg-red-900/10 transition-colors flex items-center justify-center gap-2"
        >
          <i data-lucide="x-circle" class="w-5 h-5"></i>
          Rechazar Solicitud
        </button>

        <button
          th:data-id="${solicitud.id}"
          th:data-nombre="${solicitud.empleado.nombres}"
          onclick="btnAbrirModalAprobar(this)"
          class="w-full md:w-auto px-10 py-4 rounded-full bg-accent-forest text-white font-bold hover:scale-105 active:scale-95 transition-all shadow-xl shadow-green-900/20 flex items-center justify-center gap-2"
        >
          <i data-lucide="check-circle" class="w-5 h-5"></i>
          Aprobar Solicitud
        </button>
      </div>
    </main>

    <!-- Modal Aprobar (Reutilizado) -->
    <div
      id="modalAprobar"
      class="hidden fixed inset-0 z-[100] items-center justify-center p-6"
    >
      <div
        class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity"
        onclick="cerrarModal('modalAprobar')"
      ></div>
      <div
        class="relative w-full max-w-md bg-white dark:bg-[#1C1E22] rounded-3xl p-8 shadow-2xl transform transition-all animate-in zoom-in-95 duration-200"
      >
        <div
          class="w-16 h-16 mx-auto bg-green-50 dark:bg-green-900/20 rounded-full flex items-center justify-center mb-6"
        >
          <i
            data-lucide="check"
            class="w-8 h-8 text-green-600 dark:text-green-400"
          ></i>
        </div>

        <div class="text-center mb-8">
          <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
            Autorizar Solicitud
          </h3>
          <p class="text-sm text-gray-500 leading-relaxed">
            Estás a punto de aprobar el presupuesto para
            <span
              id="nombreAprobar"
              class="font-bold text-gray-900 dark:text-white"
              >Empleado</span
            >. ¿Deseas continuar?
          </p>
        </div>

        <form id="formAprobar" method="post" class="flex flex-col gap-3">
          <button
            type="submit"
            class="w-full py-3.5 bg-accent-forest text-white font-bold rounded-xl hover:bg-[#1a241a] transition-all shadow-lg shadow-green-900/20"
          >
            Confirmar Aprobación
          </button>
          <button
            type="button"
            onclick="cerrarModal('modalAprobar')"
            class="w-full py-3.5 bg-gray-100 dark:bg-white/5 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-200 dark:hover:bg-white/10 transition-colors"
          >
            Cancelar
          </button>
        </form>
      </div>
    </div>

    <!-- Modal Rechazar (Reutilizado) -->
    <div
      id="modalRechazar"
      class="hidden fixed inset-0 z-[100] items-center justify-center p-6"
    >
      <div
        class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity"
        onclick="cerrarModal('modalRechazar')"
      ></div>
      <div
        class="relative w-full max-w-md bg-white dark:bg-[#1C1E22] rounded-3xl p-8 shadow-2xl transform transition-all animate-in zoom-in-95 duration-200"
      >
        <div
          class="w-16 h-16 mx-auto bg-red-50 dark:bg-red-900/20 rounded-full flex items-center justify-center mb-6"
        >
          <i
            data-lucide="alert-circle"
            class="w-8 h-8 text-red-600 dark:text-red-400"
          ></i>
        </div>

        <div class="text-center mb-6">
          <h3 class="text-2xl font-bold text-gray-900 dark:text-white mb-2">
            Rechazar Solicitud
          </h3>
          <p class="text-sm text-gray-500">
            Indica el motivo del rechazo para
            <span
              id="nombreRechazar"
              class="font-bold text-gray-900 dark:text-white"
              >Empleado</span
            >.
          </p>
        </div>

        <form id="formRechazar" method="post" class="space-y-6">
          <div>
            <label
              class="block text-xs font-bold text-gray-400 uppercase tracking-widest mb-2 px-1"
              >Motivo / Observación</label
            >
            <textarea
              name="comentario"
              required
              rows="4"
              class="w-full px-4 py-3 bg-gray-50 dark:bg-white/5 border border-gray-200 dark:border-white/10 rounded-xl text-sm focus:outline-none focus:ring-2 focus:ring-red-500/20 transition-all resize-none dark:text-white"
              placeholder="Escribe el motivo aquí..."
            ></textarea>
          </div>

          <div class="flex flex-col gap-3">
            <button
              type="submit"
              class="w-full py-3.5 bg-red-600 text-white font-bold rounded-xl hover:bg-red-700 transition-all shadow-lg shadow-red-900/20"
            >
              Confirmar Rechazo
            </button>
            <button
              type="button"
              onclick="cerrarModal('modalRechazar')"
              class="w-full py-3.5 bg-gray-100 dark:bg-white/5 text-gray-600 dark:text-gray-400 font-bold rounded-xl hover:bg-gray-200 dark:hover:bg-white/10 transition-colors"
            >
              Cancelar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Scripts -->
    <script th:inline="javascript">
      lucide.createIcons();

      function btnAbrirModalAprobar(btn) {
        const id = btn.getAttribute("data-id");
        const nombre = btn.getAttribute("data-nombre");
        document.getElementById("nombreAprobar").innerText = nombre;
        document.getElementById("formAprobar").action =
          "/admin/aprobaciones/aprobar/" + id;
        const modal = document.getElementById("modalAprobar");
        modal.classList.remove("hidden");
        modal.classList.add("flex");
      }

      function btnAbrirModalRechazar(btn) {
        const id = btn.getAttribute("data-id");
        const nombre = btn.getAttribute("data-nombre");
        document.getElementById("nombreRechazar").innerText = nombre;
        document.getElementById("formRechazar").action =
          "/admin/aprobaciones/rechazar/" + id;
        const modal = document.getElementById("modalRechazar");
        modal.classList.remove("hidden");
        modal.classList.add("flex");
      }

      function cerrarModal(id) {
        const modal = document.getElementById(id);
        modal.classList.add("hidden");
        modal.classList.remove("flex");
      }
    </script>
    <th:block th:replace="~{fragments/theme :: themeScript}"></th:block>
  </body>
</html>
